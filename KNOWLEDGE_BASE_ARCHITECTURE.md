# Knowledge Base (KB) Architecture

**Architectural Note:** The Knowledge Base is the central, layered data repository for the Agentic Marketing System. It is the single source of truth. All agents communicate asynchronously by reading from and writing to the KB, with every write operation being gated by the Validator Agent. For every authoritative `.json` file, a human-readable `.md` version is also generated by the Orchestrator.

---

## KB Layer Architecture

The KB is organized into distinct, numbered layers. Each layer represents a specific stage of the intelligence and content generation lifecycle.

| Layer ID | Directory Name                    | Owning Agent    | Data Description                                      | Consumed By      |
|----------|-----------------------------------|-----------------|-------------------------------------------------------|------------------|
| **1**    | `layer1_client_ground_truth/`       | `Researcher`    | Hybrid "Ground Truth" combining human-led discovery (`CLIENT_ONBOARDING_TEMPLATE.md`) and automated validation/enrichment. | `Strategy Agent` |
| **2A**   | `layer2A_website_intelligence/`     | `Researcher`    | Objective analysis of competitor websites.              | `Strategy Agent` |
| **2B**   | `layer2B_market_intelligence/`      | `Researcher`    | Third-party market analysis and sentiment.            | `Strategy Agent` |
| **2C**   | `layer2C_social_intelligence/`      | `Researcher`    | Competitor social media analysis.                     | `Strategy Agent` |
| **3**    | `layer3_strategic_frameworks/`      | `Strategy`      | Synthesized strategic insights and positioning.       | `Architect Agent`|
| **4**    | `layer4_content_architecture/`    | `Architect`     | Codified "brand bible" with voice and pillars.        | `Copywriter Agent`|
| **5**    | `layer5_production_content/`      | `Copywriter`    | Final, generated content assets.                      | `Market Intel`   |
| **6**    | `layer6_market_intelligence/`     | `Market Intel`  | Real-world performance data of published assets.      | `Optimizer Agent`|

---

## Data Flow Diagram

This diagram illustrates the flow of data through the Production and Learning Loops of the system.

```mermaid
graph TD
    subgraph "Human Input"
        A_Human(Human Operator) -- Fills out --> Template(CLIENT_ONBOARDING_TEMPLATE.md);
    end

    subgraph "Production Loop"
        Template -- Is validated/enriched by --> A_Researcher(Researcher Agent);
        A_Researcher -- Creates --> L1[Layer 1: Client Ground Truth];

        L1 --> A_Strategy;
        L2A[Layer 2A: Website Intel] --> A_Strategy;
        L2B[Layer 2B: Market Intel] --> A_Strategy;
        L2C[Layer 2C: Social Intel] --> A_Strategy;

        A_Strategy(Strategy Agent) --> L3[Layer 3: Strategic Frameworks];
        L3 --> A_Architect(Architect Agent);
        A_Architect --> L4[Layer 4: Content Architecture];
        L4 --> A_Copywriter(Copywriter Agent);
        A_Copywriter --> L5[Layer 5: Production Content];
    end

    subgraph "Learning Loop"
        L5 --> A_MarketIntel(Market Intel Agent);
        A_MarketIntel --> L6[Layer 6: Market Intelligence];
        L6 --> A_Optimizer(Optimizer Agent);
        A_Optimizer -->|Optimization PR| A_Human(Human Operator);
    end

    style A_Strategy fill:#cde4ff
    style A_Architect fill:#cde4ff
    style A_Copywriter fill:#cde4ff
    style A_MarketIntel fill:#d5ffd5
    style A_Optimizer fill:#d5ffd5
    style A_Human fill:#ffcdd2
```
